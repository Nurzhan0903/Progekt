<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! üéÇ</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap');

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden; 
            background-color: #ffc0cb; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ —Å—Ä–∞–∑—É —Ä–æ–∑–æ–≤—ã–π */
            -webkit-user-select: none; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò */
        #loader-screen {
            position: fixed; inset: 0;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 5000; background-color: #ffc0cb;
            transition: opacity 1s ease;
        }

        .loading-cake { font-size: 80px; animation: pulseCake 1.5s infinite ease-in-out; margin-bottom: 10px; }
        @keyframes pulseCake { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        .prog-bg { width: 260px; height: 12px; background: rgba(255, 255, 255, 0.4); border-radius: 10px; margin: 20px; overflow: hidden; border: 2px solid #ff69b4; }
        #progBar { width: 0%; height: 100%; background: #ff69b4; transition: width 0.4s linear; }

        /* –¢–ï–ö–°–¢ –ü–û–î –ó–ê–ì–†–£–ó–ö–û–ô (–ë–ï–ì–£–©–ê–Ø –°–¢–†–û–ö–ê) */
        #loading-text {
            font-family: 'Segoe UI', sans-serif;
            font-size: 16px;
            color: #d63384;
            height: 24px;
            text-align: center;
            font-weight: 500;
            opacity: 1;
            transition: opacity 0.5s ease;
            max-width: 80%;
        }

        /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ */
        .main-container {
            position: fixed; inset: 0;
            background-color: #ffc0cb; /* –†–æ–∑–æ–≤–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ –ø–æ–¥ –∫–∞—Ä—Ç–∏–Ω–∫—É */
            background-image: url("img/Gemini_Generated_Image_bjekxgbjekxgbjek.png");
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; transition: opacity 1.5s ease; z-index: 1000;
        }

        .snow-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; }
        .snow { position: absolute; background: white; border-radius: 50%; opacity: 0.8; top: -10px; }

        model-viewer {
            width: 100%; height: 45vh; z-index: 2;
            --poster-color: transparent; outline: none;
            filter: drop-shadow(0 0 30px rgba(255, 223, 0, 0.5));
        }

        .open-text {
            font-family: 'Dancing Script', cursive; font-size: 42px; color: #fff;
            cursor: pointer; text-align: center; margin-top: 20px; z-index: 10;
            text-shadow: 0 0 10px #ffdf00, 0 0 20px #ffdb58;
            animation: floatGlow 2.5s infinite ease-in-out;
        }
        @keyframes floatGlow { 0%, 100% { transform: translateY(0); opacity: 0.9; } 50% { transform: translateY(-10px); opacity: 1; } }

        /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
        #modal {
            display: none; position: fixed; inset: 0;
            justify-content: center; align-items: center; z-index: 6000;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
            opacity: 0; transition: opacity 0.5s ease;
        }
        .card {
            width: 92%; max-width: 420px; height: 85vh;
            background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px);
            border-radius: 40px; border: 1px solid rgba(255,255,255,0.2);
            display: flex; flex-direction: column; color: white; overflow: hidden;
        }
        .scroll { overflow-y: auto; padding: 25px; text-align: center; }
        .close-x { position: absolute; top: 15px; right: 25px; font-size: 45px; cursor: pointer; z-index: 100; }

        .player { background: rgba(255,255,255,0.2); padding: 20px; border-radius: 30px; margin-bottom: 20px; }
        #track-img { width: 120px; height: 120px; border-radius: 20px; object-fit: cover; }
        .p-btn, .skip-btn { background: none; border: none; color: white; cursor: pointer; font-size: 40px; outline: none; }

        .carousel-container { height: 220px; perspective: 1000px; margin: 20px 0; touch-action: pan-y; cursor: grab; }
        #spin { position: relative; transform-style: preserve-3d; width: 80px; height: 120px; margin: 0 auto; }
        .item { position: absolute; width: 80px; height: 120px; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.3); }
        .item img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }

        @keyframes fall { to { transform: translateY(105vh); } }
    </style>
</head>
<body>

    <div id="loader-screen">
        <div class="loading-cake">üéÇ</div>
        <div class="prog-bg"><div id="progBar"></div></div>
        <div id="loading-text">–†–∞–∑–æ–≥—Ä–µ–≤–∞–µ–º –¥—É—Ö–æ–≤–∫—É...</div>
    </div>

    <div class="main-container" id="mainContent">
        <div class="snow-wrapper" id="snowBox"></div> 
        <model-viewer id="cake" src="img/birthday_cake.glb" auto-rotate camera-controls interaction-prompt="none" disable-zoom touch-action="none" scale="0.7 0.7 0.7" exposure="1.3"></model-viewer>
        <div class="open-text" onclick="openGift()">Open Your Gift</div>
    </div>

    <div id="modal">
        <div class="card">
            <span class="close-x" onclick="closeGift()">√ó</span>
            <div class="scroll">
                <h2 style="font-family: 'Dancing Script'; font-size: 35px;">–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! üéâ</h2>
                <div class="player">
                    <img id="track-img" src="">
                    <div id="t-name" style="margin: 10px 0; font-weight: bold;">Loading...</div>
                    <div class="controls">
                        <button class="skip-btn" onclick="prevT()">‚èÆÔ∏è</button>
                        <button class="p-btn" onclick="playPause()" id="pBtn">‚ñ∂Ô∏è</button>
                        <button class="skip-btn" onclick="nextT()">‚è≠Ô∏è</button>
                    </div>
                </div>
                <div class="carousel-container" id="carouselArea">
                    <div id="spin">
                        <div class="item"><img src="img/giphy.gif"></div>
                        <div class="item"><img src="img/joy-23.gif"></div>
                        <div class="item"><img src="img/cute-happy-birthday-sticker-wink-with-cake-nzv7n1fw5n4g6ngc.gif"></div>
                        <div class="item"><img src="img/IMG-20210118-WA0027.jpg"></div>
                        <div class="item"><img src="img/Let-Her-Go-Passenger-Covers-English-2014-500x500.jpg"></div>
                    </div>
                </div>
                <p>‚ú® –ñ–µ–ª–∞—é –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Å—á–∞—Å—Ç—å—è! ‚ú®</p>
            </div>
        </div>
    </div>

    <audio id="audio" loop></audio>

    <script>
        // –°–ù–ï–ì
        const snowBox = document.getElementById('snowBox');
        for (let i = 0; i < 100; i++) {
            let s = document.createElement('div');
            s.className = 'snow';
            let size = Math.random() * 5 + 2 + 'px';
            s.style.width = size; s.style.height = size;
            s.style.left = Math.random() * 100 + 'vw';
            s.style.animation = `fall ${Math.random() * 10 + 10}s ${Math.random() * -20}s linear infinite`;
            snowBox.appendChild(s);
        }

        const tracks = [
            { name: "Happy Birthday", link: "img/happy.mp3", img: "img/020f0ed3-43be-479d-8325-0b40acf15ef5.png" },
            { name: "Let Her Go", link: "img/Let Her Go.mp3", img: "img/Let-Her-Go-Passenger-Covers-English-2014-500x500.jpg" }
        ];
        let tIdx = 1;
        const player = document.getElementById('audio');

        function setTrack(i) {
            const t = tracks[i];
            document.getElementById('t-name').innerText = t.name;
            document.getElementById('track-img').src = t.img;
            player.src = t.link;
        }

        // –¢–ï–ö–°–¢–´ –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò (–ú–ï–ù–Ø–ô –ò–• –¢–£–¢)
        const phrases = [
            "–ì–æ—Ç–æ–≤–∏–º –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ...",
            "–ó–∞–∂–∏–≥–∞–µ–º —Å–≤–µ—á–∏ –Ω–∞ —Ç–æ—Ä—Ç–µ...",
            "–ù–∞–¥—É–≤–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–µ —à–∞—Ä–∏–∫–∏...",
            "–ü–æ–¥–±–∏—Ä–∞–µ–º —Å–∞–º—ã–µ —Ç–µ–ø–ª—ã–µ —Å–ª–æ–≤–∞...",
            "–î–æ–±–∞–≤–ª—è–µ–º —â–µ–ø–æ—Ç–∫—É –º–∞–≥–∏–∏...",
            "–ü–æ—á—Ç–∏ –≤—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è —Ç–µ–±—è...",
            "–û—Å—Ç–∞–ª–æ—Å—å —Å–æ–≤—Å–µ–º —á—É—Ç—å-—á—É—Ç—å..."
        ];
        let phraseIdx = 0;

        const cakeModel = document.getElementById('cake');
        const loadingText = document.getElementById('loading-text');
        let isModelLoaded = false;
        let progress = 0;

        cakeModel.addEventListener('load', () => { isModelLoaded = true; });

        // –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–º–µ–Ω—ã —Ñ—Ä–∞–∑ (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã)
        const phraseInterval = setInterval(() => {
            if (progress < 100) {
                loadingText.style.opacity = 0;
                setTimeout(() => {
                    phraseIdx = (phraseIdx + 1) % phrases.length;
                    loadingText.innerText = phrases[phraseIdx];
                    loadingText.style.opacity = 1;
                }, 500);
            }
        }, 3000);

        // –ü–ª–∞–≤–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
        const loadManager = setInterval(() => {
            if (progress < 95) {
                progress += 0.3; // –ú–µ–¥–ª–µ–Ω–Ω–æ, —á—Ç–æ–±—ã —É—Å–ø–µ–ª–∏ –ø–æ—á–∏—Ç–∞—Ç—å
            } else if (isModelLoaded) {
                progress += 1;
            }

            document.getElementById('progBar').style.width = progress + "%";
            
            if (progress >= 100 && isModelLoaded) {
                clearInterval(loadManager);
                clearInterval(phraseInterval);
                finishLoading();
            }
        }, 60);

        function finishLoading() {
            setTrack(tIdx);
            const loader = document.getElementById('loader-screen');
            const main = document.getElementById('mainContent');
            main.style.visibility = 'visible';
            setTimeout(() => {
                loader.style.opacity = '0';
                main.style.opacity = '1';
                setTimeout(() => { loader.style.display = 'none'; }, 1000);
            }, 50);
        }

        function playPause() {
            const btn = document.getElementById('pBtn');
            if(player.paused) { player.play(); btn.innerText = "‚è∏"; }
            else { player.pause(); btn.innerText = "‚ñ∂Ô∏è"; }
        }
        function nextT() { tIdx = (tIdx + 1) % tracks.length; setTrack(tIdx); player.play(); document.getElementById('pBtn').innerText = "‚è∏"; }
        function prevT() { tIdx = (tIdx - 1 + tracks.length) % tracks.length; setTrack(tIdx); player.play(); document.getElementById('pBtn').innerText = "‚è∏"; }

        function openGift() {
            const modal = document.getElementById('modal');
            modal.style.display = 'flex';
            setTimeout(() => { modal.style.opacity = '1'; }, 10);
            if(player.paused) { player.play().then(() => { document.getElementById('pBtn').innerText = "‚è∏"; }).catch(()=>{}); }
            initCarousel();
        }

        function closeGift() {
            const modal = document.getElementById('modal');
            modal.style.opacity = '0';
            setTimeout(() => { modal.style.display = 'none'; }, 500);
        }

        let currDegree = 0;
        let rotateSpeed = 0.5;
        let isDragging = false;
        let startX = 0;

        function initCarousel() {
            const spin = document.getElementById('spin');
            const items = spin.getElementsByClassName('item');
            const area = document.getElementById('carouselArea');
            for (let i = 0; i < items.length; i++) {
                items[i].style.transform = `rotateY(${i * (360 / items.length)}deg) translateZ(160px)`;
            }
            if (!spin.dataset.init) {
                const start = (e) => { isDragging = true; startX = e.pageX || e.touches[0].pageX; };
                const move = (e) => {
                    if (!isDragging) return;
                    let x = e.pageX || e.touches[0].pageX;
                    rotateSpeed = (x - startX) * 0.15;
                    currDegree += rotateSpeed;
                    spin.style.transform = `rotateY(${currDegree}deg)`;
                    startX = x;
                };
                area.addEventListener('mousedown', start);
                area.addEventListener('mousemove', move);
                window.addEventListener('mouseup', () => isDragging = false);
                area.addEventListener('touchstart', start);
                area.addEventListener('touchmove', move);
                area.addEventListener('touchend', () => isDragging = false);
                setInterval(() => {
                    if (!isDragging) {
                        if (Math.abs(rotateSpeed) > 0.5) rotateSpeed *= 0.96;
                        else rotateSpeed = rotateSpeed > 0 ? 0.5 : -0.5;
                        currDegree += rotateSpeed;
                        spin.style.transform = `rotateY(${currDegree}deg)`;
                    }
                }, 16);
                spin.dataset.init = "true";
            }
        }
    </script>
</body>
</html>