<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! üéÇ</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden; background-color: #000;
        }

        .main-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("img/fon.avif"); 
            background-size: cover; background-position: center;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }

        #loader-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 1000; background-color: #ffc0cb;
        }
        .prog-bg { width: 250px; height: 14px; background: rgba(255,255,255,0.4); border-radius: 10px; margin: 20px; overflow: hidden; border: 3px solid #ff69b4; }
        #progBar { width: 0%; height: 100%; background: #ff69b4; }

        /* 3D –º–æ–¥–µ–ª—å - –°–£–ü–ï–† –†–ê–ó–ú–ï–† */
        model-viewer {
            width: 100%; height: 75vh;
            --poster-color: transparent;
        }

        .open-btn {
            background: rgba(255, 64, 129, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid white;
            color: white; padding: 20px 60px;
            border-radius: 50px; font-size: 24px; font-weight: bold;
            cursor: pointer; animation: bounce 2s infinite;
            margin-top: -40px; box-shadow: 0 0 30px rgba(255,105,180,0.6);
            z-index: 10;
        }

        #modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            justify-content: center; align-items: center; z-index: 900;
            background: rgba(0,0,0,0.7);
        }
        .card {
            width: 92%; max-width: 450px; height: 88vh;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border-radius: 40px; border: 1px solid rgba(255,255,255,0.3);
            display: flex; flex-direction: column; position: relative;
        }
        .close-x {
            position: absolute; top: 20px; right: 25px;
            color: white; font-size: 45px; cursor: pointer; z-index: 1001;
        }

        .confetti { position: absolute; top: -50px; animation: fall linear forwards; pointer-events: none; z-index: 1100; }
        @keyframes fall { to { transform: translateY(110vh) rotate(720deg); } }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-15px);} }

        .scroll { overflow-y: auto; padding: 25px; color: white; text-align: center; }
        
        /* –ü–õ–ï–ï–† –° –ö–ù–û–ü–ö–ê–ú–ò */
        .player { background: rgba(0,0,0,0.5); padding: 25px; border-radius: 30px; margin-bottom: 25px; }
        #track-img { width: 160px; height: 160px; border-radius: 20px; object-fit: cover; }
        .controls { display: flex; justify-content: center; align-items: center; gap: 25px; margin-top: 20px; }
        .p-btn { background: none; border: none; font-size: 50px; color: white; cursor: pointer; filter: drop-shadow(0 0 5px black); }
        .skip-btn { background: none; border: none; font-size: 35px; color: white; cursor: pointer; }

        .wishes { font-size: 19px; line-height: 1.6; margin: 25px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 20px; }

        .carousel-container { height: 260px; perspective: 1000px; margin-top: 30px; padding-bottom: 60px; }
        #spin { position: relative; display: flex; transform-style: preserve-3d; width: 110px; height: 150px; margin: 0 auto; }
        .item { position: absolute; width: 110px; height: 150px; border-radius: 15px; overflow: hidden; }
        .item img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

    <div id="loader-screen">
        <div style="font-size: 80px; animation: pulse 1s infinite;">üéÇ</div>
        <div class="prog-bg"><div id="progBar"></div></div>
        <div id="perc" style="color:#d11d7c; font-size: 26px; font-weight:bold">0%</div>
    </div>

    <div class="main-container" id="mainContent">
        <model-viewer 
            src="img/birthday_cake.glb" 
            alt="3D Cake"
            auto-rotate 
            camera-controls
            shadow-intensity="2"
            exposure="1.2"
            scale="1.5 1.5 1.5"
            touch-action="pan-y">
        </model-viewer>

        <button class="open-btn" onclick="openGift()">–û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–æ–∫ ‚ú®</button>
    </div>

    <div id="modal">
        <div class="card">
            <span class="close-x" onclick="closeGift()">√ó</span>
            <div class="scroll">
                <h1 style="font-size: 32px; margin-bottom: 25px;">–î–ª—è —Ç–µ–±—è! üéâ</h1>
                
                <div class="player">
                    <img id="track-img" src="img/020f0ed3-43be-479d-8325-0b40acf15ef5.png">
                    <div style="font-size: 22px; margin: 15px 0; font-weight: bold;" id="t-name">Happy Birthday</div>
                    
                    <div class="controls">
                        <button class="skip-btn" onclick="prevT()">‚èÆÔ∏è</button>
                        <button class="p-btn" onclick="playPause()" id="pBtn">‚ñ∂Ô∏è</button>
                        <button class="skip-btn" onclick="nextT()">‚è≠Ô∏è</button>
                    </div>
                </div>

                <div class="wishes">
                    <p>üåü –ü—É—Å—Ç—å —Å–±—ã–≤–∞—é—Ç—Å—è –º–µ—á—Ç—ã!</p>
                    <p>üéÇ –°–∞–º–æ–≥–æ –≤–∫—É—Å–Ω–æ–≥–æ —Ç–æ—Ä—Ç–∞!</p>
                    <p>üíñ –ò –º–æ—Ä–µ –ª—é–±–≤–∏!</p>
                    <p>üöÄ –¢–æ–ª—å–∫–æ –≤–ø–µ—Ä–µ–¥ –∫ —Ü–µ–ª—è–º!</p>
                </div>

                <div class="carousel-container">
                    <div id="spin">
                        <div class="item"><img src="img/giphy.gif"></div>
                        <div class="item"><img src="img/joy-23.gif"></div>
                        <div class="item"><img src="img/cute-happy-birthday-sticker-wink-with-cake-nzv7n1fw5n4g6ngc.gif"></div>
                        <div class="item"><img src="img/020f0ed3-43be-479d-8325-0b40acf15ef5.png"></div>
                        <div class="item"><img src="img/Let-Her-Go-Passenger-Covers-English-2014-500x500.jpg"></div>
                    </div>
                </div>
                <p style="opacity: 0.5; margin-top: 30px;">(–õ–∏—Å—Ç–∞–π –≤–Ω–∏–∑, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—Å—ë)</p>
            </div>
        </div>
    </div>

    <audio id="audio" loop></audio>

    <script>
        // –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (100–º—Å)
        let p = 0;
        const load = setInterval(() => {
            p++;
            document.getElementById('progBar').style.width = p + "%";
            document.getElementById('perc').innerText = p + "%";
            if(p >= 100) {
                clearInterval(load);
                setTimeout(() => {
                    document.getElementById('loader-screen').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'flex';
                }, 500);
            }

        }, 10); 

        // –ì—É—Å—Ç–æ–π –¥–æ–∂–¥—å –∏–∑ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
        setInterval(() => {
            const icons = ['‚ú®', 'üíñ', 'üéÇ', 'üå∏', 'üéâ', 'üéÅ', '‚≠ê', 'üåà'];
            const c = document.createElement('div');
            c.className = 'confetti';
            c.innerText = icons[Math.floor(Math.random()*icons.length)];
            c.style.left = Math.random()*100 + "vw";
            c.style.fontSize = Math.random()*30+15+"px";
            c.style.animationDuration = Math.random()*3+2+"s";
            document.body.appendChild(c);
            setTimeout(() => c.remove(), 4000);
        }, 120);

        // –ü–õ–ï–ï–† –° –î–í–£–ú–Ø –¢–†–ï–ö–ê–ú–ò
        const tracks = [
            { name: "Happy Birthday", link: "img/happy.mp3", img: "img/020f0ed3-43be-479d-8325-0b40acf15ef5.png" },
            { name: "Let Her Go", link: "img/Let Her Go.mp3", img: "img/Let-Her-Go-Passenger-Covers-English-2014-500x500.jpg" }
        ];
        let tIdx = 0;
        const player = document.getElementById('audio');

        function setTrack(i) {
            const t = tracks[i];
            document.getElementById('t-name').innerText = t.name;
            document.getElementById('track-img').src = t.img;
            player.src = t.link;
        }

        function playPause() {
            const btn = document.getElementById('pBtn');
            if(player.paused) { player.play(); btn.innerText = "‚è∏"; }
            else { player.pause(); btn.innerText = "‚ñ∂Ô∏è"; }
        }

        function nextT() { tIdx = (tIdx + 1) % tracks.length; setTrack(tIdx); player.play(); document.getElementById('pBtn').innerText = "‚è∏"; }
        function prevT() { tIdx = (tIdx - 1 + tracks.length) % tracks.length; setTrack(tIdx); player.play(); document.getElementById('pBtn').innerText = "‚è∏"; }

        function openGift() {
            document.getElementById('modal').style.display = 'flex';
            setTrack(tIdx); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
            startCarousel();
        }

        function closeGift() {
            document.getElementById('modal').style.display = 'none';
        }

        function startCarousel() {
            const spin = document.getElementById('spin');
            const items = spin.getElementsByClassName('item');
            for (let i = 0; i < items.length; i++) {
                items[i].style.transform = `rotateY(${i * (360 / items.length)}deg) translateZ(160px)`;
            }
            let r = 0;
            setInterval(() => { r += 0.5; spin.style.transform = `rotateY(${r}deg)`; }, 20);
        }
    </script>
</body>
</html>