<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! üéÇ</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden; background-color: #000;
            -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ–º —Å–∏–Ω–∏–π –±–ª–∏–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∞–π—Ñ–æ–Ω–∞—Ö */
        }

        /* –ó–ê–ì–†–£–ó–ö–ê */
        #loader-screen {
            position: fixed; inset: 0;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; background-color: #ffc0cb;
        }
        .prog-bg { width: 200px; height: 10px; background: rgba(255,255,255,0.4); border-radius: 10px; margin: 15px; overflow: hidden; }
        #progBar { width: 0%; height: 100%; background: #ff69b4; transition: width 0.1s linear; }

        /* –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù */
        .main-container {
            position: fixed; inset: 0;
            background: url("img/fon.avif") center/cover no-repeat;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.8s ease;
        }

        model-viewer {
            width: 100%; height: 60vh;
            --poster-color: transparent;
        }

        .open-btn {
            background: #ff4081; border: 2px solid #fff;
            color: #fff; padding: 15px 40px;
            border-radius: 30px; font-size: 20px; font-weight: bold;
            cursor: pointer; animation: bounce 2s infinite;
            box-shadow: 0 10px 20px rgba(255,64,129,0.4);
            z-index: 10;
        }

        /* –ö–ê–†–¢–û–ß–ö–ê */
        #modal {
            display: none; position: fixed; inset: 0;
            justify-content: center; align-items: center; z-index: 3000;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
        }
        .card {
            width: 88%; max-width: 400px; height: 80vh;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px; border: 1px solid rgba(255,255,255,0.2);
            display: flex; flex-direction: column; position: relative;
            color: #fff; overflow: hidden;
        }
        .scroll { overflow-y: auto; padding: 20px; text-align: center; -webkit-overflow-scrolling: touch; }
        .close-x { position: absolute; top: 10px; right: 20px; font-size: 40px; cursor: pointer; z-index: 10; }

        .player { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 20px; margin-bottom: 15px; }
        #track-img { width: 100px; height: 100px; border-radius: 15px; object-fit: cover; }
        
        /* –ö–ê–†–£–°–ï–õ–¨ - –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û */
        .carousel-container { 
            height: 180px; perspective: 1000px; margin: 20px 0;
            touch-action: pan-y; /* –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        }
        #spin { 
            position: relative; transform-style: preserve-3d; 
            width: 70px; height: 100px; margin: 0 auto;
            will-change: transform; /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –±—Ä–∞—É–∑–µ—Ä—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GPU */
        }
        .item { position: absolute; width: 70px; height: 100px; border-radius: 10px; overflow: hidden; border: 1px solid rgba(255,255,255,0.3); }
        .item img { width: 100%; height: 100%; object-fit: cover; }

        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} }
    </style>
</head>
<body>

    <div id="loader-screen">
        <div style="font-size: 50px;">üéÇ</div>
        <div class="prog-bg"><div id="progBar"></div></div>
        <div id="perc">0%</div>
    </div>

    <div class="main-container" id="mainContent">
        <model-viewer 
            src="img/birthday_cake.glb" 
            power-preference="high-performance"
            auto-rotate 
            camera-controls 
            touch-action="none">
        </model-viewer>
        <button class="open-btn" onclick="openGift()">–û—Ç–∫—Ä—ã—Ç—å üéÅ</button>
    </div>

    <div id="modal">
        <div class="card">
            <span class="close-x" onclick="closeGift()">√ó</span>
            <div class="scroll">
                <div class="player">
                    <img id="track-img" src="img/020f0ed3-43be-479d-8325-0b40acf15ef5.png">
                    <div id="t-name" style="font-size: 14px; margin: 10px 0;">Happy Birthday</div>
                    <button class="open-btn" style="padding: 10px 20px; font-size: 16px; animation: none;" onclick="playPause()" id="pBtn">‚ñ∂Ô∏è –ú—É–∑—ã–∫–∞</button>
                </div>

                <div class="carousel-container" id="carouselArea">
                    <div id="spin">
                        <div class="item"><img src="img/giphy.gif"></div>
                        <div class="item"><img src="img/joy-23.gif"></div>
                        <div class="item"><img src="img/cute-happy-birthday-sticker-wink-with-cake-nzv7n1fw5n4g6ngc.gif"></div>
                        <div class="item"><img src="img/020f0ed3-43be-479d-8325-0b40acf15ef5.png"></div>
                    </div>
                </div>
                <p style="font-size: 14px;">–ü—É—Å—Ç—å —Å–±—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –º–µ—á—Ç—ã! ‚ú®</p>
            </div>
        </div>
    </div>

    <audio id="audio" loop></audio>

    <script>
        // –ó–ê–ì–†–£–ó–ö–ê
        let p = 0;
        const load = setInterval(() => {
            p += 2;
            document.getElementById('progBar').style.width = p + "%";
            document.getElementById('perc').innerText = p + "%";
            if(p >= 100) {
                clearInterval(load);
                setTimeout(() => {
                    document.getElementById('loader-screen').style.display = 'none';
                    const mc = document.getElementById('mainContent');
                    mc.style.display = 'flex';
                    setTimeout(() => mc.style.opacity = '1', 50);
                }, 400);
            }
        }, 30);

        // –ü–õ–ï–ï–†
        const player = document.getElementById('audio');
        player.src = "img/happy.mp3";
        function playPause() {
            const btn = document.getElementById('pBtn');
            if(player.paused) { player.play(); btn.innerText = "‚è∏ –ü–∞—É–∑–∞"; }
            else { player.pause(); btn.innerText = "‚ñ∂Ô∏è –ú—É–∑—ã–∫–∞"; }
        }

        // –ö–ê–†–£–°–ï–õ–¨ (–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø)
        let currDegree = 0;
        let startX = 0;
        let isDragging = false;
        let velocity = 0.5;

        function openGift() {
            document.getElementById('modal').style.display = 'flex';
            initCarousel();
        }

        function closeGift() {
            document.getElementById('modal').style.display = 'none';
            player.pause();
        }

        function initCarousel() {
            const spin = document.getElementById('spin');
            const items = spin.getElementsByClassName('item');
            const area = document.getElementById('carouselArea');

            for (let i = 0; i < items.length; i++) {
                items[i].style.transform = `rotateY(${i * (360 / items.length)}deg) translateZ(120px)`;
            }

            if (!spin.dataset.init) {
                function update() {
                    if (!isDragging) {
                        currDegree += velocity;
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º translate3d –¥–ª—è GPU —É—Å–∫–æ—Ä–µ–Ω–∏—è
                        spin.style.transform = `translate3d(0,0,0) rotateY(${currDegree}deg)`;
                    }
                    requestAnimationFrame(update);
                }
                update();

                const start = (x) => { isDragging = true; startX = x; };
                const move = (x) => {
                    if (!isDragging) return;
                    let diff = x - startX;
                    velocity = diff * 0.3;
                    currDegree += velocity;
                    spin.style.transform = `translate3d(0,0,0) rotateY(${currDegree}deg)`;
                    startX = x;
                };
                const end = () => { isDragging = false; };

                area.addEventListener('mousedown', e => start(e.pageX));
                window.addEventListener('mousemove', e => move(e.pageX));
                window.addEventListener('mouseup', end);

                area.addEventListener('touchstart', e => start(e.touches[0].pageX), {passive: true});
                area.addEventListener('touchmove', e => move(e.touches[0].pageX), {passive: true});
                area.addEventListener('touchend', end);

                spin.dataset.init = "true";
            }
        }
    </script>
</body>
</html>
