<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! üéÇ</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden; background-color: #000;
        }

        /* –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò */
        #loader-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; background-color: #ffc0cb;
        }
        .prog-bg { width: 250px; height: 14px; background: rgba(255,255,255,0.4); border-radius: 10px; margin: 20px; overflow: hidden; border: 3px solid #ff69b4; }
        #progBar { width: 0%; height: 100%; background: #ff69b4; }

        /* –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù */
        .main-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("img/fon.avif"); 
            background-size: cover; background-position: center;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }

        model-viewer {
            width: 100%; height: 65vh;
            --poster-color: transparent;
        }

        .open-btn {
            background: rgba(255, 64, 129, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid white;
            color: white; padding: 18px 50px;
            border-radius: 50px; font-size: 22px; font-weight: bold;
            cursor: pointer; animation: bounce 2s infinite;
            margin-top: -10px; box-shadow: 0 0 30px rgba(255,105,180,0.6);
            z-index: 10;
        }

        /* –ü–û–î–ê–†–û–ö (–ú–û–î–ê–õ–ö–ê) */
        #modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            justify-content: center; align-items: center; z-index: 3000;
            background: rgba(0,0,0,0.85);
        }
        .card {
            width: 90%; max-width: 420px; height: 85vh;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(20px);
            border-radius: 40px; border: 1px solid rgba(255,255,255,0.2);
            display: flex; flex-direction: column; position: relative;
            color: white; overflow: hidden;
        }
        .scroll { overflow-y: auto; padding: 25px; text-align: center; height: 100%; }
        .close-x { position: absolute; top: 15px; right: 20px; font-size: 40px; cursor: pointer; color: white; z-index: 1001; }

        /* –ü–õ–ï–ï–† */
        .player { background: rgba(0,0,0,0.4); padding: 20px; border-radius: 30px; margin-bottom: 20px; }
        #track-img { width: 130px; height: 130px; border-radius: 20px; object-fit: cover; }
        .controls { display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 15px; }
        .p-btn { background: none; border: none; font-size: 45px; color: white; cursor: pointer; }
        .skip-btn { background: none; border: none; font-size: 30px; color: white; cursor: pointer; }

        .wishes { font-size: 17px; line-height: 1.5; margin: 15px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 20px; }

        /* –ö–ê–†–£–°–ï–õ–¨ */
        .carousel-container { 
            height: 200px; 
            perspective: 1000px; 
            margin: 30px 0; 
            position: relative; 
            touch-action: none; /* –í–∞–∂–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        }
        #spin { 
            position: relative; 
            display: flex; 
            transform-style: preserve-3d; 
            width: 80px; height: 120px; 
            margin: 0 auto; 
            will-change: transform;
        }
        .item { position: absolute; width: 80px; height: 120px; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.5); }
        .item img { width: 100%; height: 100%; object-fit: cover; }

        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} }
    </style>
</head>
<body>

    <div id="loader-screen">
        <div style="font-size: 70px; margin-bottom: 10px;">üéÇ</div>
        <div class="prog-bg"><div id="progBar"></div></div>
        <div id="perc">0%</div>
    </div>

    <div class="main-container" id="mainContent">
        <model-viewer src="img/birthday_cake.glb" alt="3D Cake" auto-rotate camera-controls shadow-intensity="2" exposure="1.2" touch-action="pan-y"></model-viewer>
        <button class="open-btn" onclick="openGift()">–û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–æ–∫ ‚ú®</button>
    </div>

    <div id="modal">
        <div class="card">
            <span class="close-x" onclick="closeGift()">√ó</span>
            <div class="scroll">
                <h2 style="margin-top:0;">–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! üéâ</h2>
                
                <div class="player">
                    <img id="track-img" src="img/020f0ed3-43be-479d-8325-0b40acf15ef5.png">
                    <div id="t-name" style="font-weight: bold; margin: 10px 0;">Happy Birthday</div>
                    <div class="controls">
                        <button class="skip-btn" onclick="prevT()">‚èÆÔ∏è</button>
                        <button class="p-btn" onclick="playPause()" id="pBtn">‚ñ∂Ô∏è</button>
                        <button class="skip-btn" onclick="nextT()">‚è≠Ô∏è</button>
                    </div>
                </div>

                <div class="wishes">
                    <p>üåü –ü—É—Å—Ç—å —Å–±—ã–≤–∞—é—Ç—Å—è –º–µ—á—Ç—ã!</p>
                    <p>üéÇ –°–∞–º–æ–≥–æ –≤–∫—É—Å–Ω–æ–≥–æ —Ç–æ—Ä—Ç–∞!</p>
                </div>

                <div class="carousel-container" id="carouselArea">
                    <div id="spin">
                        <div class="item"><img src="img/giphy.gif"></div>
                        <div class="item"><img src="img/joy-23.gif"></div>
                        <div class="item"><img src="img/cute-happy-birthday-sticker-wink-with-cake-nzv7n1fw5n4g6ngc.gif"></div>
                        <div class="item"><img src="img/020f0ed3-43be-479d-8325-0b40acf15ef5.png"></div>
                        <div class="item"><img src="img/Let-Her-Go-Passenger-Covers-English-2014-500x500.jpg"></div>
                    </div>
                </div>
                <p style="opacity: 0.5; font-size: 12px;">(–£–ø—Ä–∞–≤–ª—è–π —Å—Ç–∏–∫–µ—Ä–∞–º–∏ –ø–∞–ª—å—Ü–µ–º)</p>
            </div>
        </div>
    </div>

    <audio id="audio" loop></audio>

    <script>
        // --- –ó–ê–ì–†–£–ó–ö–ê ---
        let p = 0;
        const loadInterval = setInterval(() => {
            p++;
            document.getElementById('progBar').style.width = p + "%";
            document.getElementById('perc').innerText = p + "%";
            if(p >= 100) {
                clearInterval(loadInterval);
                setTimeout(() => {
                    document.getElementById('loader-screen').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'flex';
                }, 500);
            }
        }, 20);

        // --- –ü–õ–ï–ï–† ---
        const tracks = [
            { name: "Happy Birthday", link: "img/happy.mp3", img: "img/020f0ed3-43be-479d-8325-0b40acf15ef5.png" },
            { name: "Let Her Go", link: "img/Let Her Go.mp3", img: "img/Let-Her-Go-Passenger-Covers-English-2014-500x500.jpg" }
        ];
        let tIdx = 0;
        const player = document.getElementById('audio');
        function setTrack(i) {
            const t = tracks[i];
            document.getElementById('t-name').innerText = t.name;
            document.getElementById('track-img').src = t.img;
            player.src = t.link;
        }
        function playPause() {
            const btn = document.getElementById('pBtn');
            if(player.paused) { player.play(); btn.innerText = "‚è∏"; }
            else { player.pause(); btn.innerText = "‚ñ∂Ô∏è"; }
        }
        function nextT() { tIdx = (tIdx + 1) % tracks.length; setTrack(tIdx); player.play(); document.getElementById('pBtn').innerText = "‚è∏"; }
        function prevT() { tIdx = (tIdx - 1 + tracks.length) % tracks.length; setTrack(tIdx); player.play(); document.getElementById('pBtn').innerText = "‚è∏"; }

        // --- –ö–ê–†–£–°–ï–õ–¨ –° –ò–ù–ï–†–¶–ò–ï–ô ---
        let currDegree = 0;
        let startX = 0;
        let isDragging = false;
        let rotationSpeed = 0.5; // –ù–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∞–≤—Ç–æ-–≤—Ä–∞—â–µ–Ω–∏—è
        let autoRotate = true;

        function openGift() {
            document.getElementById('modal').style.display = 'flex';
            setTrack(tIdx);
            initCarousel();
        }

        function closeGift() {
            document.getElementById('modal').style.display = 'none';
            player.pause();
            document.getElementById('pBtn').innerText = "‚ñ∂Ô∏è";
        }

        function initCarousel() {
            const spin = document.getElementById('spin');
            const items = spin.getElementsByClassName('item');
            const area = document.getElementById('carouselArea');

            // –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞
            for (let i = 0; i < items.length; i++) {
                items[i].style.transform = `rotateY(${i * (360 / items.length)}deg) translateZ(140px)`;
            }

            if (!spin.dataset.init) {
                // –¶–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏ (–∞–≤—Ç–æ-–≤—Ä–∞—â–µ–Ω–∏–µ)
                function animate() {
                    if (!isDragging && autoRotate) {
                        currDegree += rotationSpeed;
                        spin.style.transform = `rotateY(${currDegree}deg)`;
                    }
                    requestAnimationFrame(animate);
                }
                animate();

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π
                const startAction = (x) => {
                    isDragging = true;
                    autoRotate = false;
                    startX = x;
                };

                const moveAction = (x) => {
                    if (!isDragging) return;
                    let diff = x - startX;
                    rotationSpeed = diff * 0.5; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
                    currDegree += diff * 0.5;
                    spin.style.transform = `rotateY(${currDegree}deg)`;
                    startX = x;
                };

                const stopAction = () => {
                    isDragging = false;
                    autoRotate = true; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∞–≤—Ç–æ-–≤—Ä–∞—â–µ–Ω–∏–µ, –Ω–æ —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é —Ç–≤–æ–µ–≥–æ —Å–≤–∞–π–ø–∞!
                };

                area.addEventListener('mousedown', e => startAction(e.pageX));
                window.addEventListener('mousemove', e => moveAction(e.pageX));
                window.addEventListener('mouseup', stopAction);

                area.addEventListener('touchstart', e => startAction(e.touches[0].pageX));
                window.addEventListener('touchmove', e => moveAction(e.touches[0].pageX));
                window.addEventListener('touchend', stopAction);

                spin.dataset.init = "true";
            }
        }
    </script>
</body>
</html>