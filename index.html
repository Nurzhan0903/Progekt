<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! üéÇ</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap');

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden; 
            background-color: #ffc0cb;
            -webkit-user-select: none; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        #loader-screen {
            position: fixed; inset: 0;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 5000; background-color: #ffc0cb;
            transition: opacity 1s ease;
        }

        .loading-cake { font-size: 80px; animation: pulseCake 1.5s infinite ease-in-out; margin-bottom: 10px; }
        @keyframes pulseCake { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        .prog-bg { width: 260px; height: 12px; background: rgba(255, 255, 255, 0.4); border-radius: 10px; margin: 20px; overflow: hidden; border: 2px solid #ff69b4; }
        #progBar { width: 0%; height: 100%; background: #ff69b4; transition: width 0.4s linear; }

        #loading-text {
            font-family: 'Segoe UI', sans-serif; font-size: 16px; color: #d63384;
            height: 24px; text-align: center; font-weight: 500;
            transition: opacity 0.5s ease; max-width: 80%;
        }

        .main-container {
            position: fixed; inset: 0;
            background-color: #ffc0cb;
            background-image: url("img/Gemini_Generated_Image_bjekxgbjekxgbjek.png");
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; transition: opacity 1.5s ease; z-index: 1000;
        }

        .snow-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; }
        .snow { position: absolute; background: white; border-radius: 50%; opacity: 1; top: -10px; box-shadow: 0 0 10px rgba(255, 255, 255, 0.8); }

        model-viewer {
            width: 100%; height: 45vh; z-index: 2;
            --poster-color: transparent; outline: none;
            filter: drop-shadow(0 0 50px rgba(255, 223, 0, 0.8));
        }

        .open-text {
            font-family: 'Dancing Script', cursive; font-size: 42px; color: #fff;
            cursor: pointer; text-align: center; margin-top: 20px; z-index: 10;
            text-shadow: 0 0 10px #ffdf00, 0 0 20px #ffdb58;
            animation: floatGlow 2.5s infinite ease-in-out;
        }

        #modal {
            display: none; position: fixed; inset: 0;
            justify-content: center; align-items: center; z-index: 6000;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
            opacity: 0; transition: opacity 0.5s ease;
        }
        .card {
            width: 92%; max-width: 420px; height: 85vh;
            background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px);
            border-radius: 40px; border: 1px solid rgba(255,255,255,0.2);
            display: flex; flex-direction: column; color: white; overflow: hidden;
        }
        .scroll { overflow-y: auto; padding: 25px; text-align: center; }
        .close-x { position: absolute; top: 15px; right: 25px; font-size: 45px; cursor: pointer; z-index: 100; }

        .player { background: rgba(255,255,255,0.2); padding: 20px; border-radius: 30px; margin-bottom: 20px; }
        #track-img { width: 100px; height: 100px; border-radius: 20px; object-fit: cover; }
        .p-btn, .skip-btn { background: none; border: none; color: white; cursor: pointer; font-size: 40px; outline: none; }

        .birthday-wish {
            font-family: 'Segoe UI', sans-serif; font-size: 17px; line-height: 1.5;
            margin: 20px 0 30px 0; color: #fff; text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }

        .carousel-container { height: 200px; perspective: 1000px; margin: 30px 0; touch-action: pan-y; cursor: grab; }
        #spin { position: relative; transform-style: preserve-3d; width: 80px; height: 120px; margin: 0 auto; }
        .item { position: absolute; width: 80px; height: 120px; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.3); }
        .item img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }

        @keyframes fall { to { transform: translateY(105vh); } }
        @keyframes floatGlow { 0%, 100% { transform: translateY(0); opacity: 0.9; } 50% { transform: translateY(-10px); opacity: 1; } }
    </style>
</head>
<body>

    <div id="loader-screen">
        <div class="loading-cake">üéÇ</div>
        <div class="prog-bg"><div id="progBar"></div></div>
        <div id="loading-text">–†–∞–∑–æ–≥—Ä–µ–≤–∞–µ–º –¥—É—Ö–æ–≤–∫—É...</div>
    </div>

    <div class="main-container" id="mainContent">
        <div class="snow-wrapper" id="snowBox"></div> 
        <model-viewer id="cake" src="img/birthday_cake.glb" interaction-prompt="none" disable-zoom touch-action="none" scale="0.7 0.7 0.7" exposure="2.0"></model-viewer>
        <div class="open-text" onclick="openGift()">Open Your Gift</div>
    </div>

    <div id="modal">
        <div class="card">
            <span class="close-x" onclick="closeGift()">√ó</span>
            <div class="scroll">
                <h2 style="font-family: 'Dancing Script'; font-size: 35px; margin-bottom: 10px;">–° 13-–ª–µ—Ç–∏–µ–º! üéâ</h2>
                
                <div class="player">
                    <img id="track-img" src="">
                    <div id="t-name" style="margin: 10px 0; font-weight: bold;">Loading...</div>
                    <div class="controls">
                        <button class="skip-btn" onclick="prevT()">‚èÆÔ∏è</button>
                        <button class="p-btn" onclick="playPause()" id="pBtn">‚ñ∂Ô∏è</button>
                        <button class="skip-btn" onclick="nextT()">‚è≠Ô∏è</button>
                    </div>
                </div>

                <div class="birthday-wish">
                    –ù–∞—à–µ–π –ª—é–±–∏–º–æ–π –º–ª–∞–¥—à–µ–π —Å–µ—Å—Ç—Ä—ë–Ω–∫–µ —Å–µ–≥–æ–¥–Ω—è 13! ‚ú® <br>
                    –¢—ã ‚Äî –Ω–∞—à–µ —Å–æ–ª–Ω—ã—à–∫–æ –∏ –æ–±—â–∞—è —Ä–∞–¥–æ—Å—Ç—å. –ü—É—Å—Ç—å —Ç–≤–æ—è –∂–∏–∑–Ω—å –±—É–¥–µ—Ç —Ç–∞–∫–æ–π –∂–µ —Å–ª–∞–¥–∫–æ–π, –∫–∞–∫ —ç—Ç–æ—Ç —Ç–æ—Ä—Ç! –†–æ–¥–∏—Ç–µ–ª–∏ –∏ —Ç–≤–æ–∏ 3 —Å—Ç–∞—Ä—à–∏–µ —Å–µ—Å—Ç—Ä—ã –≤—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º. –°–∏—è–π, –º–µ—á—Ç–∞–π –∏ –±—É–¥—å —Å–∞–º–æ–π —Å—á–∞—Å—Ç–ª–∏–≤–æ–π! üíñüå∏üéÅ
                </div>

                <div class="carousel-container" id="carouselArea">
                    <div id="spin">
                        <div class="item"><img src="img/giphy.gif"></div>
                        <div class="item"><img src="img/joy-23.gif"></div>
                        <div class="item"><img src="img/cute-happy-birthday-sticker-wink-with-cake-nzv7n1fw5n4g6ngc.gif"></div>
                        <div class="item"><img src="img/IMG-20210118-WA0027.jpg"></div>
                        <div class="item"><img src="img/Let-Her-Go-Passenger-Covers-English-2014-500x500.jpg"></div>
                    </div>
                </div>
                <p>‚ú® –õ—é–±–∏–º —Ç–µ–±—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ! ‚ú®</p>
            </div>
        </div>
    </div>

    <audio id="audio" loop></audio>

    <script>
        // –ë–ï–ì–£–©–ê–Ø –°–¢–†–û–ö–ê –ó–ê–ì–†–£–ó–ö–ò
        const phrases = [
            "–†–∞–∑–æ–≥—Ä–µ–≤–∞–µ–º –¥—É—Ö–æ–≤–∫—É...",
            "–ó–∞–∂–∏–≥–∞–µ–º —Å–≤–µ—á–∏...",
            "–ù–∞—Ä–µ–∑–∞–µ–º —Ç–æ—Ä—Ç–∏–∫...",
            "–ó–æ–≤—ë–º –≤—Å–µ—Ö —Å–µ—Å—Ç—ë—Ä...",
            "–ì–æ—Ç–æ–≤–∏–º –ø–æ–¥–∞—Ä–∫–∏...",
            "–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ! ‚ú®"
        ];
        let pIdx = 0;
        setInterval(() => {
            const txt = document.getElementById('loading-text');
            if(txt) {
                txt.style.opacity = 0;
                setTimeout(() => {
                    pIdx = (pIdx + 1) % phrases.length;
                    txt.innerText = phrases[pIdx];
                    txt.style.opacity = 1;
                }, 500);
            }
        }, 2500);

        const snowBox = document.getElementById('snowBox');
        for (let i = 0; i < 100; i++) {
            let s = document.createElement('div');
            s.className = 'snow';
            let size = Math.random() * 8 + 4 + 'px';
            s.style.width = size; s.style.height = size;
            s.style.left = Math.random() * 100 + 'vw';
            s.style.animation = `fall ${Math.random() * 10 + 10}s ${Math.random() * -20}s linear infinite`;
            snowBox.appendChild(s);
        }

        const tracks = [
            { name: "Happy Birthday", link: "img/happy.mp3", img: "img/020f0ed3-43be-479d-8325-0b40acf15ef5.png" },
            { name: "Let Her Go", link: "img/Let Her Go.mp3", img: "img/Let-Her-Go-Passenger-Covers-English-2014-500x500.jpg" }
        ];
        let tIdx = 1;
        const player = document.getElementById('audio');
        function setTrack(i) {
            const t = tracks[i];
            document.getElementById('t-name').innerText = t.name;
            document.getElementById('track-img').src = t.img;
            player.src = t.link;
        }

        const cakeModel = document.getElementById('cake');
        const carouselImages = document.querySelectorAll('#spin img');
        let isModelLoaded = false, loadedImgCount = 0, progress = 0, startTime = Date.now();

        cakeModel.addEventListener('load', () => { isModelLoaded = true; });
        carouselImages.forEach(img => {
            if (img.complete) loadedImgCount++;
            else {
                img.addEventListener('load', () => loadedImgCount++);
                img.addEventListener('error', () => loadedImgCount++);
            }
        });

        const loadManager = setInterval(() => {
            if (progress < 90) progress += 0.5; 
            else if (isModelLoaded || (Date.now() - startTime) > 15000) progress += 2; 
            document.getElementById('progBar').style.width = progress + "%";
            if (progress >= 100) { clearInterval(loadManager); finishLoading(); }
        }, 50);

        function finishLoading() {
            setTrack(tIdx);
            const loader = document.getElementById('loader-screen'), main = document.getElementById('mainContent');
            main.style.visibility = 'visible';
            setTimeout(() => {
                loader.style.opacity = '0';
                main.style.opacity = '1';
                setTimeout(() => { loader.style.display = 'none'; initCakeControl(); }, 1000);
            }, 50);
        }

        function playPause() {
            const btn = document.getElementById('pBtn');
            if(player.paused) { player.play(); btn.innerText = "‚è∏"; }
            else { player.pause(); btn.innerText = "‚ñ∂Ô∏è"; }
        }
        function nextT() { tIdx = (tIdx + 1) % tracks.length; setTrack(tIdx); player.play(); document.getElementById('pBtn').innerText = "‚è∏"; }
        function prevT() { tIdx = (tIdx - 1 + tracks.length) % tracks.length; setTrack(tIdx); player.play(); document.getElementById('pBtn').innerText = "‚è∏"; }

        function openGift() {
            const modal = document.getElementById('modal');
            modal.style.display = 'flex';
            setTimeout(() => { modal.style.opacity = '1'; }, 10);
            if(player.paused) player.play().then(() => { document.getElementById('pBtn').innerText = "‚è∏"; }).catch(()=>{});
            initCarousel();
        }

        function closeGift() {
            const modal = document.getElementById('modal');
            modal.style.opacity = '0';
            setTimeout(() => { modal.style.display = 'none'; }, 500);
        }

        let cakeCurrDegree = 0, cakeRotateSpeed = 0.05, isCakeDragging = false, cakeStartX = 0;

        function initCakeControl() {
            const cake = document.getElementById('cake');
            const start = (e) => { isCakeDragging = true; cakeStartX = e.pageX || e.touches[0].pageX; };
            const move = (e) => {
                if (!isCakeDragging) return;
                let x = e.pageX || e.touches[0].pageX;
                // –ò–ù–í–ï–†–°–ò–Ø –¢–£–¢: –ø–æ—Å—Ç–∞–≤–∏–ª –º–∏–Ω—É—Å –ø–µ—Ä–µ–¥ —Å–∫–æ–±–∫–æ–π
                cakeRotateSpeed = -(x - cakeStartX) * 0.1; 
                cakeCurrDegree += cakeRotateSpeed;
                updateCakeRotation();
                cakeStartX = x;
            };

            cake.addEventListener('mousedown', start);
            cake.addEventListener('touchstart', start);
            window.addEventListener('mousemove', move);
            window.addEventListener('touchmove', move);
            window.addEventListener('mouseup', () => isCakeDragging = false);
            window.addEventListener('touchend', () => isCakeDragging = false);

            setInterval(() => {
                if (!isCakeDragging) {
                    if (Math.abs(cakeRotateSpeed) > 0.05) cakeRotateSpeed *= 0.96; 
                    else cakeRotateSpeed = cakeRotateSpeed > 0 ? 0.05 : -0.05; 
                    cakeCurrDegree += cakeRotateSpeed;
                    updateCakeRotation();
                }
            }, 16);
        }

        function updateCakeRotation() {
            document.getElementById('cake').cameraOrbit = `${cakeCurrDegree}deg 75deg auto`;
        }

        let currDegree = 0, rotateSpeed = 0.4, isDragging = false, startX = 0;

        function initCarousel() {
            const spin = document.getElementById('spin'), items = spin.getElementsByClassName('item'), area = document.getElementById('carouselArea');
            for (let i = 0; i < items.length; i++) {
                // translateZ(130px) - –°–î–ï–õ–ê–õ –ë–õ–ò–ñ–ï
                items[i].style.transform = `rotateY(${i * (360 / items.length)}deg) translateZ(130px)`;
            }

            if (!spin.dataset.init) {
                const start = (e) => { isDragging = true; startX = e.pageX || e.touches[0].pageX; };
                const move = (e) => {
                    if (!isDragging) return;
                    let x = e.pageX || e.touches[0].pageX;
                    rotateSpeed = (x - startX) * 0.05;
                    currDegree += rotateSpeed;
                    spin.style.transform = `rotateY(${currDegree}deg)`;
                    startX = x;
                };
                area.addEventListener('mousedown', start);
                area.addEventListener('mousemove', move);
                window.addEventListener('mouseup', () => isDragging = false);
                area.addEventListener('touchstart', start);
                area.addEventListener('touchmove', move);
                area.addEventListener('touchend', () => isDragging = false);

                setInterval(() => {
                    if (!isDragging) {
                        if (Math.abs(rotateSpeed) > 0.3) rotateSpeed *= 0.96;
                        else rotateSpeed = rotateSpeed > 0 ? 0.4 : -0.4;
                        currDegree += rotateSpeed;
                        spin.style.transform = `rotateY(${currDegree}deg)`;
                    }
                }, 16);
                spin.dataset.init = "true";
            }
        }
    </script>
</body>
</html>